<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>Title</title>
    <script src="../node_modules/js-xlsx/dist/xlsx.full.min.js"></script>
    <script src="../node_modules/canvas-datagrid/dist/canvas-datagrid.debug.js"></script>
    <style>
        canvas-datagrid{
            display: inline-block;
            height: 200px;
            width: 750px;
        }
    </style>
</head>
<body>

<input type="file" onchange="importf(this)" />
<div id="demo"></div>
<script>
	/*
    FileReader共有4种读取方法：
    1.readAsArrayBuffer(file)：将文件读取为ArrayBuffer。
    2.readAsBinaryString(file)：将文件读取为二进制字符串
    3.readAsDataURL(file)：将文件读取为Data URL
    4.readAsText(file, [encoding])：将文件读取为文本，encoding缺省值为'UTF-8'
                 */
	var wb;//读取完成的数据
	var rABS = false; //是否将文件读取为二进制字符串

	function importf(obj) {//导入
		if(!obj.files) {
			return;
		}
		var f = obj.files[0];
		var grid = canvasDatagrid();
		document.body.appendChild(grid);
		var reader = new FileReader();
		reader.onload = function(e) {
			var data = e.target.result;
			if(rABS) {
				wb = XLSX.read(btoa(fixdata(data)), {//手动转化
					type: 'base64'
				});
			} else {
				wb = XLSX.read(data, {
					type: 'binary'
				});
			}
			//wb.SheetNames[0]是获取Sheets中第一个Sheet的名字
			//wb.Sheets[Sheet名]获取第一个Sheet的数据
			// document.getElementById("demo").innerHTML= JSON.stringify
            // ( XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]) );

			grid.data=JSON.stringify( XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]) );
		};
		if(rABS) {
			reader.readAsArrayBuffer(f);
		} else {
			reader.readAsBinaryString(f);
		}
	}

	function fixdata(data) { //文件流转BinaryString
		var o = "",
			l = 0,
			w = 10240;
		for(; l < data.byteLength / w; ++l) o += String.fromCharCode.apply(null, new Uint8Array(data.slice(l * w, l * w + w)));
		o += String.fromCharCode.apply(null, new Uint8Array(data.slice(l * w)));
		return o;
	}

</script>

作者：关爱单身狗成长协会
链接：https://www.jianshu.com/p/74d405940305
來源：简书
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。
</body>
</html>